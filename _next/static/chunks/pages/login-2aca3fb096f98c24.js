(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3236:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(1123)}])},4695:function(e,t,r){"use strict";r.d(t,{H:function(){return u},a:function(){return s}});var n=r(5893),a=r(7294),o=r(2798);let l=(0,a.createContext)(void 0),u=e=>{let{children:t}=e,[r,u]=(0,a.useState)(null),[s,i]=(0,a.useState)(()=>localStorage.getItem("km_token")),[c,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(s)try{let e=JSON.parse(atob(s.split(".")[1]||""));u({id:e.sub,username:e.username,region:e.region})}catch(e){u(null)}else u(null)},[s]);let f=async(e,t)=>{d(!0);let r=await (0,o.pH)(e,t);if(d(!1),r.error||!r.data)return{ok:!1,error:r.error||"Login failed"};let{token:n}=r.data;return localStorage.setItem("km_token",n),i(n),{ok:!0}},h=async(e,t,r)=>{d(!0);let n=await (0,o.a$)(e,t,r);if(d(!1),n.error||!n.data)return{ok:!1,error:n.error||"Register failed"};let{token:a}=n.data;return localStorage.setItem("km_token",a),i(a),{ok:!0}};return(0,n.jsx)(l.Provider,{value:{user:r,token:s,loading:c,login:f,register:h,logout:()=>{localStorage.removeItem("km_token"),i(null),u(null)}},children:t})};function s(){let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},1123:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(5893),a=r(7294),o=r(1163),l=r(4695),u=r(3878);function s(){let{login:e}=(0,l.a)(),t=(0,o.useRouter)(),[r,s]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),[d,f]=(0,a.useState)(null),h=async()=>{f(null);let n=await e(r,i);n.ok?t.push("/"):f(n.error||"Login failed")};return(0,n.jsxs)(u.Zb,{className:"max-w-md mx-auto p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Login"}),d&&(0,n.jsx)(u.bZ,{variant:"error",children:d}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(u.II,{value:r,onChange:e=>s(e.target.value),placeholder:"Username"}),(0,n.jsx)(u.II,{type:"password",value:i,onChange:e=>c(e.target.value),placeholder:"Password"}),(0,n.jsx)(u.zx,{onClick:h,fullWidth:!0,children:"Login"})]})]})}function i(){return(0,n.jsx)(l.H,{children:(0,n.jsx)("div",{className:"py-12",children:(0,n.jsx)(s,{})})})}}},function(e){e.O(0,[942,888,774,179],function(){return e(e.s=3236)}),_N_E=e.O()}]);